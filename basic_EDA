import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

ratings = pd.read_csv('ratings_export.csv')
movies = pd.read_csv(
    'movie_data.csv',
    quotechar='"',
    encoding='utf-8',
    engine='python'
)
users = pd.read_csv('users_export.csv')

# BASIC INFORMATION ABOUT DATA
print(ratings.head())
print(movies.head())
print(users.head())

print("Ratings shape:", ratings.shape)
print("Movies shape:", movies.shape)
print("Users shape:", users.shape)

print(ratings.info())
print(movies.info())
print(users.info())

# MISSING VALUES
print(ratings.isnull().sum())
print(movies.isnull().sum())
print(users.isnull().sum())

# TOP MOVIES
df = ratings.merge(movies, on='movie_id', how='left')
top_movies = df.groupby('movie_title').agg({'rating_val':['mean','count']})
top_movies = top_movies[top_movies[('rating_val','count')] >= 50].sort_values(('rating_val','mean'), ascending=False)
print(top_movies.head(10))

ratings = ratings.dropna(subset=['movie_id'])
movies = movies.dropna(subset=['movie_id','movie_title'])  # keep movies with ID & title
movies['genres'] = movies['genres'].fillna('Unknown')
movies['overview'] = movies['overview'].fillna('')

# DISTRIBUTION OF RATINGS PLOT
sns.histplot(ratings['rating_val'], bins=5)
plt.title("Distribution of Ratings")
plt.xlabel("Rating")
plt.ylabel("Count")
plt.show()

# RATINGS PER USER PLOT
ratings_per_user = ratings.groupby('user_id')['rating_val'].count()
sns.histplot(ratings_per_user, bins=50, log_scale=(False, True))
plt.title("Ratings per User")
plt.show()

# RATINGS PER MOVIE PLOT
ratings_per_movie = ratings.groupby('movie_id')['rating_val'].count()
sns.histplot(ratings_per_movie, bins=50, log_scale=(False, True))
plt.title("Ratings per Movie")
plt.show()
